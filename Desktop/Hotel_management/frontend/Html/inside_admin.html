<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Management Dashboard</title>
   <!----> <link rel="stylesheet" href="../Css/inside_admin.css">
</head>
<body>
    <header>
        <h1 >Hotel Management Dashboard</h1>
        <nav>
            <ul>
                <li><a href="#rooms">Rooms</a></li>
                <li><a href="#users">Users</a></li>
                <li><a href="#payments">Payments</a></li>
                <li><a href="#feedback">Feedback</a></li>
                <li><a href="#contact-info">Contact</a></li>
                <li><a href="payment.html">Payments</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Rooms Section -->
        <section id="rooms">
            <h2>Rooms</h2>
            <table>
                <thead>
                    <tr>
                        <th>Room ID</th>
                        <th>Room Number</th>
                        <th>Room Type</th>
                        <th>Price Per Night</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="rooms-table">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
        </section>

        <!-- Users Section -->
        <section id="users">
            <h2>Users</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                    </tr>
                </thead>
                <tbody id="users-table">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
        </section>
        <!--Contact informartion Section-->
        <section id="contact-info">
            <h2>Contact Information</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Message</th>
                        <th>Created At</th>
                    </tr>
                </thead>
                <tbody id="contact-info-table">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
        </section>
        <!-- Payments Section -->
        <section id="payments">
            <h2>Payments</h2>
            <table>
                <thead>
                    <tr>
                        <th>Room boucher ID</th>
                        <th>Amount Paid</th>
                        <th>Payment Method</th>
                        <th>Payment Date</th>
                    </tr>
                </thead>
                <tbody id="payments-table">
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
        </section>
    </main>

    <script>
       // Fetch Rooms Data
fetch('http://localhost:8000/getrooms/')
    .then(response => response.json())
    .then(rooms => {
        const roomsTable = document.getElementById('rooms-table');
        rooms.forEach(room => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${room.id}</td>
                <td>${room.room_number}</td>
                <td>${room.room_type}</td>
                <td>$${room.price_per_night.toFixed(2)}</td>
                <td>
                    <select class="status-dropdown" data-room-id="${room.id}">
                        <option value="Available" ${room.status === 'Available' ? 'selected' : ''}>Available</option>
                        <option value="Occupied" ${room.status === 'Occupied' ? 'selected' : ''}>Occupied</option>
                        <option value="Maintenance" ${room.status === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                    </select>
                </td>
            `;
            roomsTable.appendChild(row);
        });
    })
    .catch(error => console.error('Error fetching rooms data:', error));

// Event Listener for Status Change


// Event Listener for Status Change
document.addEventListener('change', async (e) => {
    if (e.target.classList.contains('status-dropdown')) {
        const roomId = e.target.getAttribute('data-room-id');
        const newStatus = e.target.value;
        console.log("roomId:", roomId);
        // Send PATCH request to update the room status
        const response = await fetch(`http://localhost:8000/rooms/${roomId}/status`, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: newStatus }), // Send the new status in the body
        });
        console.log("inside event listener")
        if (response.ok) {
            alert('Room status updated successfully!');
        } else {
            const error = await response.json();
            alert('Failed to update room status: ' + error.detail);
        }
    }
});
        // Fetch Users Data
        fetch('http://localhost:8000/getusers/')
            .then(response => response.json())
            .then(users => {
                const usersTable = document.getElementById('users-table');
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.phone}</td>
                    `;
                    usersTable.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching users data:', error));
            
        fetch('http://localhost:8000/contact_info/')  // Replace with correct API endpoint for contact_info
            .then(response => response.json())
            .then(contactInfo => {
                const contactTable = document.getElementById('contact-info-table'); // Table ID where data will be displayed
                contactInfo.forEach(contact => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${contact.name}</td>
                        <td>${contact.email}</td>
                        <td>${contact.message}</td>
                        <td>${new Date(contact.created_at).toLocaleString()}</td>
                `;
                contactTable.appendChild(row);
            });
        })
        .catch(error => console.error('Error fetching contact info data:', error));

        fetch('http://localhost:8000/getpayments/')
    .then(response => response.json())
    .then(payments => {
        if (Array.isArray(payments) && payments.length > 0) {
            const paymentsTable = document.getElementById('payments-table');
            payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.room_boucher_id}</td>
                    <td>$${payment.amount_paid}</td>
                    <td>${payment.payment_method}</td>
                    <td>${new Date(payment.payment_date).toLocaleString()}</td>
                `;
                paymentsTable.appendChild(row);
            });
        } else {
            const paymentsTable = document.getElementById('payments-table');
            paymentsTable.innerHTML = '<tr><td colspan="4">No payment data available.</td></tr>';
        }
    })
    .catch(error => console.error('Error fetching payment data:', error));

            

   
    </script>
</body>
</html>
